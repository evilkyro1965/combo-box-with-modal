<!DOCTYPE html>
<html lang="en-US">
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui"/>
    <title>Prototype1</title>
    <link rel="stylesheet" type="text/css" href="combo-modal.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="jquery-2.1.3.js"></script>
		<script>
			(function($) {
				counterId = 1;
				
				$.fn.comboModal = function( options ) {
					
					$(this).each(function(){  
						var comboModalId = "#"+$(this).attr('id');
						
						options = $.extend({}, $.fn.comboModal.defaultOptions, options);
						var data = options.data;
						if(data.length>0){
							var id = "#jqueryComboModal"+counterId;
							$(comboModalId).append("<div id='jqueryComboModal"+counterId+"' class='jqueryComboModal'></div>");
							options.id = id;
							
							for(var i=0;i<data.length;i++) {
								$(options.id).append("<a href='javascript:;' value='"+data[i].value+"'>"+data[i].label+"</a>");
							}
						}
						
						$(this).on('click',function(e){
							//var showModal = options.show == true ? false : true;
							//options.show = showModal;
							if(!$(comboModalId+" "+".jqueryComboModal").is(":visible")) {
								$(comboModalId+" "+".jqueryComboModal").show();
							}
							else {
								$(comboModalId+" "+".jqueryComboModal").hide();
							}
						});
						
						$(document).mouseup(function (e){
						
								var container = $(comboModalId+" "+".jqueryComboModal");

								if (!container.is(e.target) 
										&& container.has(e.target).length === 0) 
								{
									options.show = false;	
									container.hide();
								}
								
						});
						
						$(options.id+" a").on('click',function(event){
							//options.show = false;
							var target = $(event.target);
							//var showModal = options.show == true ? false : true;
							//options.show = showModal;
							options.selected.label = target.html();
							options.selected.value = target.attr('value');
							$(comboModalId).data("selected",options.selected);
							$(comboModalId).find(".label").html(options.selected.label);
						});
						counterId++;
						
					});		

  			};
				     
				$.fn.comboModal.defaultOptions = {
					data : new Array(),
					modalDiv : 
						"<div class='jqueryComboModal'>"+
						"</div>",
					show : false,
					selected : {},
					id : ""
				};
					
			}(jQuery));


			$(document).ready(function() {
				
				var data = [
					{'value':'en','label':'English'},
					{'value':'ina','label':'Indonesia'}
				];

				var country = [
					{'value':'usa','label':'United States Of America'},
					{'value':'indonesia','label':'Indonesia'}
				];


				$("#language").comboModal({'data':data});
				$("#country").comboModal({'data':country});
				
				$("#getSelected").on('click',function(){
					var selected = $("#language").data('selected');
					console.log(selected);
				});
				$("#getCountry").on('click',function(){
					var selected = $("#country").data('selected');
					console.log(selected);
				});


			});

		</script>

</head>
<body>
	<a href="javascript:;" id="language" class="combo"><span class='label'>Language</label></a>
	<a href="javascript:;" id="getSelected">Get Selected</a>
	<a href="javascript:;" id="country" class="combo"><span class='label'>Country</label></a>
	<a href="javascript:;" id="getCountry">Get Selected</a>
</body>
</html>
